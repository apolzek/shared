<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoC Grafana Faro - Corrigido</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üìä PoC Grafana Faro</h1>
            <p>Gerenciamento de Itens Frontend</p>
        </div>

        <div class="content">
            <div id="debug-info" class="debug-info">
                Debug<br>
                Status do Faro: <span id="faro-status">Inicializando...</span><br>
                Requests enviados: <span id="request-count">0</span><br>
                √öltimo erro: <span id="last-error">Nenhum</span><br>
                Trace ativo: <span id="active-trace">Nenhum</span>
            </div>

            <div id="message-container"></div>

            <div class="form-section">
                <h3 style="margin-bottom: 20px; color: #495057;">Adicionar/Editar Item</h3>
                <form id="item-form">
                    <div class="form-group">
                        <label for="item-name">Nome do Item:</label>
                        <input type="text" id="item-name" name="name" required>
                    </div>

                    <div class="form-group">
                        <label for="item-description">Descri√ß√£o:</label>
                        <textarea id="item-description" name="description" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="item-price">Pre√ßo:</label>
                        <input type="number" id="item-price" name="price" step="0.01" min="0">
                    </div>

                    <button type="submit" class="btn btn-primary" id="submit-btn">
                        Adicionar Item
                    </button>
                    <button type="button" class="btn btn-warning" id="cancel-btn" style="display: none;">
                        Cancelar Edi√ß√£o
                    </button>
                </form>
            </div>

            <div class="items-list">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="color: #495057;">Lista de Itens</h3>
                    <button class="btn btn-success" onclick="loadItems()">üîÑ Atualizar</button>
                </div>
                <div id="items-container">
                    <div class="loading">Carregando itens...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const FARO_COLLECTOR_URL = 'http://localhost:12347/collect';
        const API_BASE_URL = 'http://localhost:3002/api';

        let faroInstance = null;
        let tracer = null;
        let trace = null;
        let context = null;
        let isInitialized = false;

        let requestCount = 0;
        let spanCount = 0;

        const FAILURE_CONFIG = {
            enabled: true,
            loadItemsFailureRate: 0.3, // 30% de chance de falha
            addItemFailureRate: 0.2,   // 20% de chance de falha
            updateItemFailureRate: 0.15, // 15% de chance de falha
            deleteItemFailureRate: 0.1   // 10% de chance de falha
        };


        const debugElements = {
            status: document.getElementById('faro-status'),
            requests: document.getElementById('request-count'),
            error: document.getElementById('last-error'),
            trace: document.getElementById('active-trace')
        };

        let editingIndex = null;

        function updateDebugInfo(status, error = null) {
            if (debugElements.status) debugElements.status.textContent = status;
            if (debugElements.requests) debugElements.requests.textContent = requestCount;
            if (error && debugElements.error) debugElements.error.textContent = error;
        }

        function updateActiveTrace(traceId = null) {
            if (debugElements.trace) {
                debugElements.trace.textContent = traceId ? traceId.substring(0, 16) + '...' : 'Nenhum';
            }
        }

        function debugLog(message, data = {}) {
            console.log(`[FARO] ${message}`, data);
        }

        let sdksLoaded = 0;
        const requiredSDKs = ['GrafanaFaroWebSdk', 'GrafanaFaroWebTracing'];

        function shouldSimulateFailure(operation) {
            if (!FAILURE_CONFIG.enabled) return false;

            const rate = FAILURE_CONFIG[`${operation}FailureRate`] || 0;
            return Math.random() < rate;
        }

        function simulateFailure(operation) {
            const errors = {
                loadItems: new Error('Falha simulada ao carregar itens - timeout de conex√£o'),
                addItem: new Error('Falha simulada ao adicionar item - servidor indispon√≠vel'),
                updateItem: new Error('Falha simulada ao atualizar item - conflito de dados'),
                deleteItem: new Error('Falha simulada ao excluir item - permiss√£o negada')
            };

            const error = errors[operation] || new Error(`Falha simulada na opera√ß√£o: ${operation}`);
            error.isSimulated = true;
            error.operation = operation;

            logEvent(`Falha simulada: ${operation}`, 'error', {
                operation,
                simulated: true,
                errorMessage: error.message
            });

            throw error;
        }
        function checkSDKsReady() {
            const loaded = requiredSDKs.filter(sdk => window[sdk]);
            sdksLoaded = loaded.length;

            debugLog(`SDKs carregados: ${sdksLoaded}/${requiredSDKs.length}`, {
                loaded,
                GrafanaFaroWebSdk: !!window.GrafanaFaroWebSdk,
                GrafanaFaroWebTracing: !!window.GrafanaFaroWebTracing
            });

            if (sdksLoaded === requiredSDKs.length && !isInitialized) {
                setTimeout(initializeFaro, 500);
            }
        }

        // CORRE√á√ÉO: Fun√ß√£o melhorada para inje√ß√£o de headers
        function injectTraceHeaders() {
            debugLog('üîç Tentando injetar headers de trace...');

            if (!faroInstance?.api?.getOTEL) {
                debugLog('‚ùå OTEL n√£o dispon√≠vel');
                return { 'Content-Type': 'application/json' };
            }

            try {
                const otel = faroInstance.api.getOTEL();
                const activeContext = otel.context.active();

                // Verificar se h√° span ativo
                const activeSpan = otel.trace.getActiveSpan(activeContext);
                if (activeSpan) {
                    const spanContext = activeSpan.spanContext();
                    debugLog('üìä Span ativo encontrado:', {
                        traceId: spanContext.traceId,
                        spanId: spanContext.spanId
                    });
                    updateActiveTrace(spanContext.traceId);
                } else {
                    debugLog('‚ö†Ô∏è Nenhum span ativo encontrado');
                    updateActiveTrace();
                }

                // Verificar se propagation est√° dispon√≠vel
                if (!otel.propagation || !otel.propagation.inject) {
                    debugLog('‚ùå Propagation n√£o dispon√≠vel no OTEL');

                    // Fallback: tentar construir traceparent manualmente
                    if (activeSpan) {
                        const spanContext = activeSpan.spanContext();
                        const traceparent = `00-${spanContext.traceId}-${spanContext.spanId}-01`;

                        debugLog('üîß Usando fallback manual para traceparent:', { traceparent });

                        return {
                            'Content-Type': 'application/json',
                            'traceparent': traceparent
                        };
                    }

                    return { 'Content-Type': 'application/json' };
                }

                // Criar carrier vazio para inje√ß√£o
                const carrier = {};

                // Injetar contexto no carrier
                otel.propagation.inject(activeContext, carrier);

                // Construir headers finais
                const headers = {
                    'Content-Type': 'application/json',
                    ...carrier
                };

                if (headers.traceparent) {
                    debugLog('‚úÖ Headers de trace injetados:', {
                        traceparent: headers.traceparent,
                        tracestate: headers.tracestate || 'none'
                    });
                } else {
                    debugLog('‚ùå Falha ao injetar traceparent');
                }

                return headers;

            } catch (error) {
                debugLog('‚ùå Erro ao injetar headers:', error.message);

                // Tentar fallback em caso de erro
                try {
                    const otel = faroInstance.api.getOTEL();
                    const activeContext = otel.context.active();
                    const activeSpan = otel.trace.getActiveSpan(activeContext);

                    if (activeSpan) {
                        const spanContext = activeSpan.spanContext();
                        const traceparent = `00-${spanContext.traceId}-${spanContext.spanId}-01`;

                        debugLog('üîß Usando fallback ap√≥s erro:', { traceparent });

                        return {
                            'Content-Type': 'application/json',
                            'traceparent': traceparent
                        };
                    }
                } catch (fallbackError) {
                    debugLog('‚ùå Fallback tamb√©m falhou:', fallbackError.message);
                }

                return { 'Content-Type': 'application/json' };
            }
        }

        // CORRE√á√ÉO: Fun√ß√£o consistente para todas as requisi√ß√µes
        async function makeTracedRequest(url, options = {}) {
            const headers = injectTraceHeaders();

            const finalOptions = {
                ...options,
                headers: {
                    ...headers,
                    ...options.headers
                }
            };

            debugLog(`üåê Fazendo requisi√ß√£o para ${url}`, {
                method: finalOptions.method || 'GET',
                headers: finalOptions.headers
            });

            try {
                const response = await fetch(url, finalOptions);

                // Log do trace ID retornado pelo backend
                const backendTraceId = response.headers.get('X-Trace-Id');
                const backendSpanId = response.headers.get('X-Span-Id');

                if (backendTraceId) {
                    debugLog('üîó Trace ID do backend recebido:', {
                        backendTraceId,
                        backendSpanId
                    });
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return response;
            } catch (error) {
                debugLog('‚ùå Erro na requisi√ß√£o:', error.message);
                throw error;
            }
        }

        function initializeFaro() {
            if (isInitialized || !window.GrafanaFaroWebSdk || !window.GrafanaFaroWebTracing) {
                debugLog('Inicializa√ß√£o abortada', {
                    initialized: isInitialized,
                    webSdk: !!window.GrafanaFaroWebSdk,
                    tracing: !!window.GrafanaFaroWebTracing
                });
                return;
            }

            try {
                const { initializeFaro, getWebInstrumentations } = window.GrafanaFaroWebSdk;
                const { TracingInstrumentation } = window.GrafanaFaroWebTracing;

                debugLog('Inicializando Faro...');

                faroInstance = initializeFaro({
                    app: {
                        name: 'frontend',
                        version: '0.0.1',
                        environment: 'development'
                    },
                    url: FARO_COLLECTOR_URL,
                    sessionTracking: {
                        enabled: true,
                        persistent: true
                    },
                    instrumentations: [
                        ...getWebInstrumentations({
                            captureConsole: true,
                            webVitals: true,
                            performance: true
                        }),
                        new TracingInstrumentation({
                            enabled: true,
                            tracingOrigins: [/localhost/, /127\.0\.0\.1/],
                            propagateTraceHeaderCorsUrls: [/http:\/\/localhost:3002.*$/],
                            ignoreIncomingRequestHook: () => false,
                            ignoreOutgoingRequestHook: (url) => {
                                return url.includes('localhost:12347');
                            }
                        })
                    ],
                    beforeSend: (payload) => {
                        requestCount++;
                        debugLog(`üì§ Enviando payload: ${payload.type}`);
                        updateDebugInfo('Ativo - Enviando dados');
                        return payload;
                    }
                });

                setupTracing();
                isInitialized = true;
                updateDebugInfo('‚úÖ Ativo - Inicializado');

                debugLog('‚úÖ Faro inicializado com sucesso');

            } catch (error) {
                debugLog('‚ùå Erro na inicializa√ß√£o', { error: error.message });
                updateDebugInfo('‚ùå Erro na inicializa√ß√£o', error.message);
            }
        }

        function setupTracing() {
            if (!faroInstance?.api?.getOTEL) {
                debugLog('‚ùå OTEL API n√£o dispon√≠vel no Faro');
                return;
            }

            try {
                const otel = faroInstance.api.getOTEL();

                trace = otel.trace;
                context = otel.context;
                tracer = trace?.getTracer('item-manager-frontend', '0.0.1');

                debugLog('‚úÖ Tracing configurado', {
                    trace: !!trace,
                    context: !!context,
                    tracer: !!tracer
                });
            } catch (error) {
                debugLog('‚ùå Erro ao configurar tracing', { error: error.message });
            }
        }

        // CORRE√á√ÉO: Span creation melhorada
        function createSpan(spanName, operation, attributes = {}) {
            if (!tracer) {
                debugLog(`‚ö†Ô∏è Executando ${spanName} sem tracing`);
                return Promise.resolve(operation());
            }

            return new Promise((resolve, reject) => {
                const span = tracer.startSpan(spanName, {
                    attributes: {
                        'service.name': 'frontend',
                        'component': 'item-manager',
                        ...attributes
                    }
                });

                spanCount++;
                const spanContext = span.spanContext();
                debugLog(`üìä Span criado: ${spanName}`, {
                    traceId: spanContext.traceId,
                    spanId: spanContext.spanId
                });

                // Executar opera√ß√£o no contexto do span
                context.with(trace.setSpan(context.active(), span), async () => {
                    try {
                        const startTime = performance.now();
                        const result = await operation();

                        span.setAttributes({
                            'operation.success': true,
                            'operation.duration_ms': Math.round(performance.now() - startTime)
                        });
                        span.setStatus({ code: 1 }); // OK

                        resolve(result);
                    } catch (error) {
                        span.setAttributes({
                            'operation.success': false,
                            'error.message': error.message,
                            'error.name': error.name
                        });
                        span.setStatus({ code: 2, message: error.message }); // ERROR

                        debugLog(`‚ùå Erro no span ${spanName}`, { error: error.message });
                        reject(error);
                    } finally {
                        span.end();
                        debugLog(`üèÅ Span finalizado: ${spanName}`);
                    }
                });
            });
        }

        function logEvent(message, level = 'info', context = {}) {
            const timestamp = new Date().toISOString();
            const logData = {
                timestamp,
                component: 'item-manager-frontend',
                url: window.location.href,
                level: level,
                message: message,
                job: 'frontend',
                service: 'item-manager',
                environment: 'development',
                ...context
            };

            console[level === 'warn' ? 'warn' : level === 'error' ? 'error' : 'log'](`[${timestamp}] ${message}`, logData);

            if (faroInstance?.api) {
                try {
                    faroInstance.api.pushLog([message], {
                        level: level,
                        context: logData
                    });
                } catch (error) {
                    console.error('‚ùå Erro ao enviar log para Faro:', error);
                }
            }
        }

        function showMessage(message, type = 'success') {
            const messageContainer = document.getElementById('message-container');
            if (!messageContainer) return;

            messageContainer.innerHTML = `
                <div class="message ${type}">
                    ${message}
                </div>
            `;

            logEvent('Mensagem exibida', 'info', { message, type });
            setTimeout(() => messageContainer.innerHTML = '', 5000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        async function loadItems() {
            const operation = async () => {
                // Simular falha se configurado
                if (shouldSimulateFailure('loadItems')) {
                    simulateFailure('loadItems');
                }

                const itemsContainer = document.getElementById('items-container');
                if (itemsContainer) {
                    itemsContainer.innerHTML = '<div class="loading">Carregando itens...</div>';
                }

                const response = await makeTracedRequest(`${API_BASE_URL}/items`);
                const items = await response.json();

                displayItems(items);
                logEvent('Itens carregados', 'info', { count: items.length });
                return items;
            };

            if (tracer) {
                return createSpan('items.load', operation, {
                    'http.method': 'GET',
                    'http.url': `${API_BASE_URL}/items`,
                    'operation.type': 'database.query'
                }).catch(error => {
                    const isSimulated = error.isSimulated || false;
                    showMessage(`Erro ao carregar itens: ${error.message}`, 'error');
                    logEvent('Erro no carregamento', 'error', {
                        error: error.message,
                        simulated: isSimulated,
                        operation: 'loadItems'
                    });

                    const itemsContainer = document.getElementById('items-container');
                    if (itemsContainer) {
                        itemsContainer.innerHTML = `<div class="error-message">‚ùå Erro: ${error.message}</div>`;
                    }
                });
            } else {
                return operation().catch(error => {
                    const isSimulated = error.isSimulated || false;
                    showMessage(`Erro ao carregar itens: ${error.message}`, 'error');
                    logEvent('Erro no carregamento', 'error', {
                        error: error.message,
                        simulated: isSimulated,
                        operation: 'loadItems'
                    });
                });
            }
        }

        function displayItems(items) {
            const itemsContainer = document.getElementById('items-container');
            if (!itemsContainer) return;

            if (items.length === 0) {
                itemsContainer.innerHTML = `
                    <div class="no-items">
                        üì¶ Nenhum item encontrado. Adicione o primeiro item!
                    </div>
                `;
                return;
            }

            const itemsHTML = items.map((item, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <div>
                            <h4 class="item-title">${escapeHtml(item.name || 'Item sem nome')}</h4>
                            <p style="color: #6c757d; margin: 5px 0;">
                                ${escapeHtml(item.description || 'Sem descri√ß√£o')}
                            </p>
                            ${item.price ? `<p style="color: #28a745; font-weight: 600; font-size: 1.1rem;">R$ ${parseFloat(item.price).toFixed(2)}</p>` : ''}
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-warning" onclick="editItem(${index})">
                                ‚úèÔ∏è Editar
                            </button>
                            <button class="btn btn-danger" onclick="deleteItem(${index})">
                                üóëÔ∏è Excluir
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            itemsContainer.innerHTML = itemsHTML;
        }

        async function addItem(itemData) {
            const operation = async () => {
                const response = await makeTracedRequest(`${API_BASE_URL}/items`, {
                    method: 'POST',
                    body: JSON.stringify(itemData)
                });

                showMessage('Item adicionado com sucesso!');
                logEvent('Item adicionado', 'info', { name: itemData.name });

                return response.json();
            };

            if (tracer) {
                return createSpan('items.add', operation, {
                    'http.method': 'POST',
                    'http.url': `${API_BASE_URL}/items`,
                    'item.name': itemData.name,
                    'operation.type': 'database.create'
                });
            } else {
                return operation();
            }
        }

        // CORRE√á√ÉO: Usar makeTracedRequest
        async function updateItem(index, itemData) {
            const operation = async () => {
                const response = await makeTracedRequest(`${API_BASE_URL}/items/${index}`, {
                    method: 'PUT',
                    body: JSON.stringify(itemData)
                });

                showMessage('Item atualizado com sucesso!');
                logEvent('Item atualizado', 'info', { index, name: itemData.name });
                return response.json();
            };

            if (tracer) {
                return createSpan('items.update', operation, {
                    'http.method': 'PUT',
                    'http.url': `${API_BASE_URL}/items/${index}`,
                    'item.index': index,
                    'item.name': itemData.name,
                    'operation.type': 'database.update'
                });
            } else {
                return operation();
            }
        }

        // CORRE√á√ÉO: Usar makeTracedRequest
        async function deleteItem(index) {
            if (!confirm('Tem certeza que deseja excluir este item?')) {
                logEvent('Exclus√£o cancelada', 'info', { index });
                return;
            }

            const operation = async () => {
                const response = await makeTracedRequest(`${API_BASE_URL}/items/${index}`, {
                    method: 'DELETE'
                });

                showMessage('Item exclu√≠do com sucesso!');
                await loadItems();

                logEvent('Item exclu√≠do', 'info', { index });
                return true;
            };

            if (tracer) {
                return createSpan('items.delete', operation, {
                    'http.method': 'DELETE',
                    'http.url': `${API_BASE_URL}/items/${index}`,
                    'item.index': index,
                    'operation.type': 'database.delete'
                }).catch(error => {
                    showMessage(`Erro ao excluir: ${error.message}`, 'error');
                    logEvent('Erro na exclus√£o', 'error', { index, error: error.message });
                });
            } else {
                return operation().catch(error => {
                    showMessage(`Erro ao excluir: ${error.message}`, 'error');
                    logEvent('Erro na exclus√£o', 'error', { index, error: error.message });
                });
            }
        }

        // CORRE√á√ÉO: Usar makeTracedRequest
        function editItem(index) {
            const operation = async () => {
                const response = await makeTracedRequest(`${API_BASE_URL}/items`);
                const items = await response.json();
                const item = items[index];

                if (item) {
                    document.getElementById('item-name').value = item.name || '';
                    document.getElementById('item-description').value = item.description || '';
                    document.getElementById('item-price').value = item.price || '';

                    editingIndex = index;
                    document.getElementById('submit-btn').textContent = 'Atualizar Item';
                    document.getElementById('cancel-btn').style.display = 'inline-block';

                    document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });

                    logEvent('Edi√ß√£o iniciada', 'info', { index, name: item.name });
                }
                return item;
            };

            if (tracer) {
                createSpan('items.edit_start', operation, {
                    'item.index': index,
                    'operation.type': 'ui.edit_start'
                }).catch(error => logEvent('Erro na edi√ß√£o', 'error', { index, error: error.message }));
            } else {
                operation().catch(error => logEvent('Erro na edi√ß√£o', 'error', { index, error: error.message }));
            }
        }

        function cancelEdit() {
            resetForm();
            logEvent('Edi√ß√£o cancelada', 'info');
        }

        function resetForm() {
            document.getElementById('item-form').reset();
            editingIndex = null;
            document.getElementById('submit-btn').textContent = 'Adicionar Item';
            document.getElementById('cancel-btn').style.display = 'none';
        }

        async function handleFormSubmit(e) {
            e.preventDefault();

            const formData = new FormData(e.target);
            const itemData = {
                name: formData.get('name').trim(),
                description: formData.get('description').trim(),
                price: formData.get('price') ? parseFloat(formData.get('price')) : null
            };

            if (!itemData.name) {
                showMessage('Nome do item √© obrigat√≥rio!', 'error');
                logEvent('Valida√ß√£o falhou', 'warn', { reason: 'nome_vazio' });
                return;
            }

            try {
                if (editingIndex !== null) {
                    await updateItem(editingIndex, itemData);
                } else {
                    await addItem(itemData);
                }

                resetForm();
                await loadItems();
            } catch (error) {
                showMessage(`Erro na opera√ß√£o: ${error.message}`, 'error');
                logEvent('Erro na opera√ß√£o', 'error', { error: error.message });
            }
        }

        // Handlers de erro
        window.addEventListener('error', (event) => {
            logEvent('Erro JavaScript', 'error', {
                message: event.message,
                filename: event.filename,
                lineno: event.lineno,
                colno: event.colno
            });
        });

        window.addEventListener('unhandledrejection', (event) => {
            logEvent('Promise rejeitada', 'error', {
                reason: event.reason?.toString?.()?.substring(0, 200) || 'Unknown'
            });
        });

        // INIT
        document.addEventListener('DOMContentLoaded', function () {
            logEvent('üöÄ Aplica√ß√£o iniciada', 'info', {
                url: window.location.href,
                referrer: document.referrer || 'direct'
            });

            const itemForm = document.getElementById('item-form');
            const cancelBtn = document.getElementById('cancel-btn');

            if (itemForm) itemForm.addEventListener('submit', handleFormSubmit);
            if (cancelBtn) cancelBtn.addEventListener('click', cancelEdit);

            loadItems();
            checkSDKsReady();
        });

        // Debug helpers
        window.faroDebug = {
            state: () => ({
                initialized: isInitialized,
                hasFaroInstance: !!faroInstance,
                hasTracer: !!tracer,
                spanCount,
                requestCount,
                sdksLoaded: `${sdksLoaded}/${requiredSDKs.length}`
            }),

            testSpan: () => {
                if (!tracer) {
                    console.warn('‚ö†Ô∏è Tracer n√£o dispon√≠vel');
                    return;
                }

                createSpan('test.manual', async () => {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    console.log('‚úÖ Teste de span executado com sucesso!');
                    return 'success';
                }, { 'test.type': 'manual' });
            },

            testConnection: async () => {
                try {
                    const response = await fetch(FARO_COLLECTOR_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ test: 'connection', timestamp: Date.now() })
                    });

                    console.log('üåê Teste de conex√£o:', response.status, response.statusText);
                    return response.ok;
                } catch (error) {
                    console.error('‚ùå Erro na conex√£o:', error.message);
                    return false;
                }
            },

            testTraceHeaders: () => {
                const headers = injectTraceHeaders();
                console.log('üîç Headers de teste:', headers);
                return headers;
            }
        };

        setTimeout(() => {
            if (!isInitialized && sdksLoaded < requiredSDKs.length) {
                debugLog('‚è∞ Timeout: SDKs n√£o carregaram completamente', {
                    loaded: sdksLoaded,
                    required: requiredSDKs.length
                });
                updateDebugInfo('‚ùå Erro - SDKs n√£o carregaram', 'Timeout ap√≥s 5s');
            }
        }, 5000);

        debugLog('üìú Script carregado. Use window.faroDebug para debug.');
    </script>

    <script src="https://unpkg.com/@grafana/faro-web-sdk@^1.0.0/dist/bundle/faro-web-sdk.iife.js"
        onload="checkSDKsReady()"
        onerror="console.error('Erro ao carregar Faro Web SDK'); document.getElementById('faro-status').textContent = 'Erro faro-web-sdk.iife.js';"></script>

    <script src="https://unpkg.com/@grafana/faro-web-tracing@^1.0.0/dist/bundle/faro-web-tracing.iife.js"
        onload="checkSDKsReady()"
        onerror="console.error('Erro ao carregar Faro Web Tracing'); updateDebugInfo('Erro faro-web-tracing.iife.js');"
        crossorigin></script>
</body>

</html>